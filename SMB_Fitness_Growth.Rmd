---
title: "SMB_Fitness_Growth"
author: "Joe Gunn"
date: "3/17/2021"
output: html_document
---

## Libraries needed for analysis
```{r, include=FALSE}
library(readxl)
library(tidyverse)
library(cowplot)
library(sp)
library(popgraph)
library(cowplot)
library(nlme)
library(lme4)
library(factoextra)
library(MASS)
library(logihist)
library(pophelper)
library(ggpubr)
library(DescTools)
library(gstudio)
library(FSAdata)
library(FSA) #v.0.8.32
library(boot)
library(car)
```

## Read in and clean  data for analysis
```{r}
smbfit_raw_data <- read_excel("../../raw_data/master_data/smbfit_master_data_working.xlsx")
smbfit_bc_raw_data <- read_excel("../../raw_data/backcalc_data/smbfit_bc_noHSYC.xlsx")

smbfit_age_data <- smbfit_raw_data[,-c(1:4,6:11,13:17,19:23,25:31:33,35:40)]
smbfit_age_data$estimate <- factor(c(rep("actual",times=119)))

smbfit_bc_data <- smbfit_bc_raw_data[-c(150:265),-c(1)]

smbfit_age_data_clean <- rbind(smbfit_age_data,smbfit_bc_data)

smbfit_age_data_clean <- smbfit_age_data_clean %>%
  mutate(river = factor(river),
         tl_alive = as.numeric(tl_alive),
         sex = factor(sex),
         hyb_status = factor(hyb_status))

smbfit_age_data_clean_noNA <- smbfit_age_data_clean[-c(47:49,119),]

smbfit_age_data_clean_actual <- smbfit_age_data_clean_noNA %>%
  filter(estimate=="actual")

```

## Prepare to fit von Bertalanffy growth models to genetic groups (Pure Neosho, Pure Northern, Admixed) based on results from Structure for K=2, without the Honey Creek and Sycamore Creek reference population.
```{r}

##Split the dataset into three usable datasets for admixed individuals, pure neosho, and pure northern
smbfit_age_admixed <- smbfit_age_data_clean_noNA %>%
  filter(hyb_status =="Admixed")

smbfit_age_admixed <- smbfit_age_admixed[-50,]

smbfit_age_neosho <- smbfit_age_data_clean_noNA %>%
  filter(hyb_status =="Neosho")

smbfit_age_northern <- smbfit_age_data_clean_noNA %>%
  filter(hyb_status =="Northern")

```

## Fit models to genetic groups
```{r}
#Write a funciton for optimizing the von Bert model (this is used below)
vb_function <- vbFuns(param = "Typical")

#Get starting values for von Bert optimization
f_starts_admixed <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_admixed)
f_starts_neosho <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_neosho)
f_starts_northern <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_northern)

#Fit von Bert function
fit_admixed <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_admixed, start = f_starts_admixed)
fit_neosho <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_neosho, start = f_starts_neosho)
fit_northern <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_northern, start = f_starts_northern)

#Get coefficients from the model fit
admix_coefficients <- coef(fit_admixed)
    #Linf = 393.58
    #K = 0.42
    #t0 = -0.05

neosho_coefficients <- coef(fit_neosho)
    #Linf = 431.07
    #K = 0.33
    #t0 = -0.27

northern_coefficients <- coef(fit_northern)
    #Linf = 446.26
    #K = 0.29
    #t0 = -0.26

admix_bootstrap <- Boot(fit_admixed) #996 out of 999 attempted
neosho_bootstrap <- Boot(fit_neosho) #998 out of 999 attempted
northern_bootstrap <- Boot(fit_northern) #998 out of 999 attempted

admix_confint <- confint(admix_bootstrap)
neosho_confint <- confint(neosho_bootstrap)
northern_confint <- confint(northern_bootstrap)

admix_pred <- predict(fit_admixed,data.frame(consensus_age=2:8))
neosho_pred <- predict(fit_neosho,data.frame(consensus_age=2:7))
northern_pred <- predict(fit_northern,data.frame(consensus_age=2:7)) 

#write functions to bootstrap over individual ages
pred_2_function_admix <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:8
pred_2_function_admix(fit_admixed)

pred_2_function_neosho <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
pred_2_function_neosho(fit_neosho)

pred_2_function_northern<- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
pred_2_function_admix(fit_northern)


ages <- seq(-1,15,by=0.2)
admix_indiv_boot <- Boot(fit_admixed, f = pred_2_function_admix) #998 out of 999

ages <- seq(-1,15,by=0.2)
neosho_indiv_boot <- Boot(fit_neosho, f = pred_2_function_neosho) #997 out of 999

ages <- seq(-1,15,by=0.2)
northern_indiv_boot <- Boot(fit_northern, f = pred_2_function_northern) #998 out of 999

preds1_admix <- data.frame(ages,
                     predict(fit_admixed,data.frame(consensus_age=ages)),
                     confint(admix_indiv_boot))
names(preds1_admix) <- c("age","fit","LCI","UCI")
preds1_admix$hyb_status <- c(rep("Admixed",times=81))


preds1_neosho <- data.frame(ages,
                     predict(fit_neosho,data.frame(consensus_age=ages)),
                     confint(neosho_indiv_boot))
names(preds1_neosho) <- c("age","fit","LCI","UCI")
preds1_neosho$hyb_status <- c(rep("Neosho",times=81))

preds1_northern <- data.frame(ages,
                     predict(fit_northern,data.frame(consensus_age=ages)),
                     confint(northern_indiv_boot))
names(preds1_northern) <- c("age","fit","LCI","UCI")
preds1_northern$hyb_status <- c(rep("Northern",times=81))

preds1_all_smb <- rbind(preds1_admix,
                        preds1_neosho,
                        preds1_northern)


preds1_obs_admix <- filter(preds1_admix,age>=2,age<=8)
preds1_obs_admix$hyb_status <- c(rep("Admixed",times=31))

preds1_obs_neosho <- filter(preds1_neosho,age>=2,age<=7)
preds1_obs_neosho$hyb_status <- c(rep("Neosho",times=26))

preds1_obs_northern <- filter(preds1_northern,age>=2,age<=7)
preds1_obs_northern$hyb_status <- c(rep("Northern",times=26))

preds1_obs_all_smb <- rbind(preds1_obs_admix,
                        preds1_obs_neosho,
                        preds1_obs_northern)

preds1_all_smb_positive <- preds1_all_smb[-c(1:10),]
```

## Prepare to fit Von Bertalanffy growth models to sexes
```{r}
##Split the dataset into three usable datasets for admixed individuals, pure neosho, and pure northern
smbfit_age_male <- smbfit_age_data_clean_noNA %>%
  filter(sex =="Male")

smbfit_age_female <- smbfit_age_data_clean_noNA %>%
  filter(sex =="Female")

```

## Fit models to sexes
```{r}


#Write a funciton for optimizing the von Bert model (this is used below)
vb_function <- vbFuns(param = "Typical")

#Get starting values for von Bert optimization
f_starts_male <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_male)
f_starts_female <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_female)

#Fit von Bert function
fit_male <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_male, start = f_starts_male)
fit_female <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_female, start = f_starts_female)


#Get coefficients from the model fit
male_coefficients <- coef(fit_male)
    #Linf = 417.86
    #K = 0.38
    #t0 = -0.06

female_coefficients <- coef(fit_female)
    #Linf = 418.71
    #K = 0.33
    #t0 = -0.22

male_bootstrap <- Boot(fit_male) #997 out of 999 attempted
female_bootstrap <- Boot(fit_female) #998 out of 999 attempted

male_confint <- confint(male_bootstrap)
female_confint <- confint(female_bootstrap)

male_pred <- predict(fit_male,data.frame(consensus_age=2:7))
female_pred <- predict(fit_female,data.frame(consensus_age=2:8))


#write functions to bootstrap over individual ages
pred_2_function_male <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
pred_2_function_male(fit_male)

pred_2_function_female <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:8
pred_2_function_female(fit_female)


ages <- seq(-1,15,by=0.2)
male_indiv_boot <- Boot(fit_male, f = pred_2_function_male) #996 out of 999

ages <- seq(-1,15,by=0.2)
female_indiv_boot <- Boot(fit_female, f = pred_2_function_female) #996 out of 999


preds1_male <- data.frame(ages,
                     predict(fit_male,data.frame(consensus_age=ages)),
                     confint(male_indiv_boot))
names(preds1_male) <- c("age","fit","LCI","UCI")
preds1_male$sex <- c(rep("Male",times=81))


preds1_female <- data.frame(ages,
                     predict(fit_female,data.frame(consensus_age=ages)),
                     confint(female_indiv_boot))
names(preds1_female) <- c("age","fit","LCI","UCI")
preds1_female$sex <- c(rep("Female",times=81))


preds1_all_sexes <- rbind(preds1_male,
                        preds1_female)


preds1_obs_male <- filter(preds1_male,age>=2,age<=7)
preds1_obs_male$sex <- c(rep("Male",times=26))

preds1_obs_female <- filter(preds1_female,age>=2,age<=8)
preds1_obs_female$sex <- c(rep("Female",times=31))

preds1_obs_all_sexes <- rbind(preds1_obs_male,
                        preds1_obs_female)

```

## Prepare to fit Von Bertalanffy growth models to rivers
```{r}
##Split the dataset into three usable datasets for admixed individuals, pure neosho, and pure northern
smbfit_age_elk <- smbfit_age_data_clean_noNA %>%
  filter(river =="ELK")

smbfit_age_bsug <- smbfit_age_data_clean_noNA %>%
  filter(river =="BSUG")

```

## Fit models to rivers
```{r}


#Write a funciton for optimizing the von Bert model (this is used below)
vb_function <- vbFuns(param = "Typical")

#Get starting values for von Bert optimization
f_starts_elk <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_elk)
f_starts_bsug <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_bsug)

#Fit von Bert function
fit_elk <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_elk, start = f_starts_elk)
fit_bsug <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_bsug, start = f_starts_bsug)


#Get coefficients from the model fit
elk_coefficients <- coef(fit_elk)
    #Linf = 391.04
    #K = 0.44
    #t0 = 0.01

bsug_coefficients <- coef(fit_bsug)
    #Linf = 476.84
    #K = 0.25
    #t0 = -0.38

elk_bootstrap <- Boot(fit_elk) #997 out of 999 attempted
bsug_bootstrap <- Boot(fit_bsug) #998 out of 999 attempted

elk_confint <- confint(elk_bootstrap)
bsug_confint <- confint(bsug_bootstrap)

elk_pred <- predict(fit_elk,data.frame(consensus_age=2:8))
bsug_pred <- predict(fit_bsug,data.frame(consensus_age=2:7))


#write functions to bootstrap over individual ages
pred_2_function_elk <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:8
pred_2_function_elk(fit_elk)

pred_2_function_bsug <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
pred_2_function_bsug(fit_bsug)


ages <- seq(-1,15,by=0.2)
elk_indiv_boot <- Boot(fit_elk, f = pred_2_function_elk) #995 out of 999

ages <- seq(-1,15,by=0.2)
bsug_indiv_boot <- Boot(fit_bsug, f = pred_2_function_bsug) #996 out of 999


preds1_elk <- data.frame(ages,
                     predict(fit_elk,data.frame(consensus_age=ages)),
                     confint(elk_indiv_boot))
names(preds1_elk) <- c("age","fit","LCI","UCI")
preds1_elk$river <- c(rep("ELK",times=81))


preds1_bsug <- data.frame(ages,
                     predict(fit_bsug,data.frame(consensus_age=ages)),
                     confint(bsug_indiv_boot))
names(preds1_bsug) <- c("age","fit","LCI","UCI")
preds1_bsug$river <- c(rep("BSUG",times=81))


preds1_all_rivers <- rbind(preds1_elk,
                        preds1_bsug)


preds1_obs_elk <- filter(preds1_elk,age>=2,age<=8)
preds1_obs_elk$river <- c(rep("ELK",times=31))

preds1_obs_bsug <- filter(preds1_bsug,age>=2,age<=7)
preds1_obs_bsug$river <- c(rep("BSUG",times=26))

preds1_obs_all_rivers <- rbind(preds1_obs_elk,
                        preds1_obs_bsug)
```


## Plotting
```{r}
#Plot von Bert growth for all admixture status groups (Pure Neosho, Pure Northern, and Admixed)
vonbert_admix_status <- ggplot() + 
  geom_ribbon(data=preds1_all_smb, aes(x = age, ymin = LCI, ymax = UCI,fill = hyb_status, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual,aes(x = consensus_age,y = tl_alive, fill = hyb_status), show.legend = T, size=2, pch=21, position = position_jitter(width = 0.2)) + 
  geom_line(data=preds1_all_smb, aes(x=age, y=fit, linetype = hyb_status)) +
  theme_set(theme_cowplot(12)) +
  scale_fill_manual(values=c("mediumpurple","deepskyblue","deeppink2")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,530),expand=c(0,0)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Admixture Status", linetype = "Admixture Status") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.5,0.4)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 12)) +
  scale_alpha(guide = 'none') +
  theme(axis.title.y = element_blank())

pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Fitness/visualization/growth_figures/von_bert_admixture_groups.pdf", width = 7, height = 5)

ggplot() + 
  geom_ribbon(data=preds1_all_smb, aes(x = age, ymin = LCI, ymax = UCI,fill = hyb_status, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual,aes(x = consensus_age,y = tl_alive, fill = hyb_status), show.legend = T, size=2, pch=21, position = position_jitter(width = 0.2)) + 
  geom_line(data=preds1_all_smb, aes(x=age, y=fit, linetype = hyb_status)) +
  theme_set(theme_cowplot(12)) +
  scale_fill_manual(values=c("mediumpurple","deepskyblue","deeppink2")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,520),expand=c(0,0)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Admixture Status", linetype = "Admixture Status") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.7,0.4)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 12)) +
  scale_alpha(guide = 'none')

dev.off()

#Plot von Bert growth for all admixture status groups (Pure Neosho, Pure Northern, and Admixed)
vonbert_sex <- ggplot() + 
  geom_ribbon(data=preds1_all_sexes, aes(x = age, ymin = LCI, ymax = UCI,fill = sex, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual,aes(x = consensus_age,y = tl_alive, fill = sex), show.legend = T, size=2, pch=21, position = position_jitter(width = 0.2)) + 
  geom_line(data=preds1_all_sexes, aes(x=age, y=fit, linetype = sex)) +
  theme_set(theme_cowplot(12)) +
  scale_fill_manual(values=c("grey","black")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,500),expand=c(0,0)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Sex", linetype = "Sex") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.5,0.4)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 12)) +
  scale_alpha(guide = 'none') +
  theme(axis.title.y = element_blank())


pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Fitness/visualization/growth_figures/von_bert_sexes.pdf", width = 7, height = 5)

ggplot() + 
  geom_ribbon(data=preds1_all_sexes, aes(x = age, ymin = LCI, ymax = UCI,fill = sex, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual,aes(x = consensus_age,y = tl_alive, fill = sex), show.legend = T, size=2, pch=21, position = position_jitter(width = 0.2)) + 
  geom_line(data=preds1_all_sexes, aes(x=age, y=fit, linetype = sex)) +
  theme_set(theme_cowplot(12)) +
  scale_fill_manual(values=c("grey","black")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,500),expand=c(0,0)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Sex", linetype = "Sex") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.7,0.4)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 12)) +
  scale_alpha(guide = 'none')

dev.off()

preds1_all_rivers <- preds1_all_rivers %>%
  mutate(river = factor(river))

levels(preds1_all_rivers$river) <- c("Big Sugar Creek", "Elk River")
levels(smbfit_age_data_clean_actual$river) <- c("Big Sugar Creek", "Elk River")

pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Fitness/visualization/growth_figures/von_bert_rivers.pdf", width = 7, height = 5)

vonbert_river <- ggplot() + 
  geom_ribbon(data=preds1_all_rivers, aes(x = age, ymin = LCI, ymax = UCI,fill = river, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual, aes(x = consensus_age, y = tl_alive, fill = river), show.legend = T, size=2, pch=21, position = position_jitter(width = 0.2)) + 
  geom_line(data=preds1_all_rivers, aes(x=age, y=fit, linetype = river)) +
  theme_set(theme_cowplot(12)) +
  scale_fill_manual(values=c("grey","black")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,520),expand=c(0,0)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "River", linetype = "River") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.5,0.4)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 12)) +
  scale_alpha(guide = 'none') 

dev.off()

pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Fitness/visualization/growth_figures/all_von_berts.pdf", width = 15, height = 5)

plot_grid(vonbert_river,
          vonbert_sex,
          vonbert_admix_status,
          nrow=1)

dev.off()
```



## Here I will attempt to do two replicated growth curves, one for Elk River and one for Big Sugar Creek, running separate curves for each genetic group within each rvier.

## Prepare to fit von Bertalanffy growth models to genetic groups (Pure Neosho, Pure Northern, Admixed) based on results from Structure for K=2, without the Honey Creek and Sycamore Creek reference population.
```{r}

smbfit_age_data_clean_actual_bsug <- smbfit_age_data_clean_actual %>%
  filter(river=="BSUG")

smbfit_age_data_clean_actual_elk <- smbfit_age_data_clean_actual %>%
  filter(river=="ELK")

## BIG SUGAR CREEK
##Split the dataset into three usable datasets for admixed individuals, pure neosho, and pure northern
smbfit_age_bsug_admixed <- smbfit_age_bsug %>%
  filter(hyb_status =="Admixed")

smbfit_age_bsug_neosho <- smbfit_age_bsug %>%
  filter(hyb_status =="Neosho")

smbfit_age_bsug_northern <- smbfit_age_bsug %>%
  filter(hyb_status =="Northern")


## ELK RIVER
##Split the dataset into three usable datasets for admixed individuals, pure neosho, and pure northern
smbfit_age_elk_admixed <- smbfit_age_elk %>%
  filter(hyb_status =="Admixed")

smbfit_age_elk_neosho <- smbfit_age_elk %>%
  filter(hyb_status =="Neosho")

smbfit_age_elk_northern <- smbfit_age_elk %>%
  filter(hyb_status =="Northern")
```

## Fit models to genetic groups WITHIN BIG SUGAR CREEK
```{r}
#Write a funciton for optimizing the von Bert model (this is used below)
vb_function <- vbFuns(param = "Typical")

#Get starting values for von Bert optimization
f_starts_bsug_admixed <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_bsug_admixed)
f_starts_bsug_neosho <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_bsug_neosho)
f_starts_bsug_northern <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_bsug_northern)

#Fit von Bert function
fit_bsug_admixed <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_bsug_admixed, start = f_starts_bsug_admixed)
fit_bsug_neosho <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_bsug_neosho, start = f_starts_bsug_neosho)
fit_bsug_northern <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_bsug_northern, start = f_starts_bsug_northern)

#Get coefficients from the model fit
bsug_admix_coefficients <- coef(fit_bsug_admixed)
    #Linf = 474.54
    #K = 0.26
    #t0 = -0.31

bsug_neosho_coefficients <- coef(fit_bsug_neosho)
    #Linf = 466.32
    #K = 0.27
    #t0 = -0.29

bsug_northern_coefficients <- coef(fit_bsug_northern)
    #Linf = 347.20
    #K = 0.44
    #t0 = -0.15

bsug_admix_bootstrap <- Boot(fit_bsug_admixed) #996 out of 999 attempted
bsug_neosho_bootstrap <- Boot(fit_bsug_neosho) #997 out of 999 attempted
bsug_northern_bootstrap <- Boot(fit_bsug_northern) #919 out of 999 attempted

bsug_admix_confint <- confint(bsug_admix_bootstrap)
bsug_neosho_confint <- confint(bsug_neosho_bootstrap)
bsug_northern_confint <- confint(bsug_northern_bootstrap)

bsug_admix_pred <- predict(fit_bsug_admixed,data.frame(consensus_age=2:7))
bsug_neosho_pred <- predict(fit_bsug_neosho,data.frame(consensus_age=2:7))
bsug_northern_pred <- predict(fit_bsug_northern,data.frame(consensus_age=2:4)) 

#write functions to bootstrap over individual ages
bsug_pred_2_function_admix <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
bsug_pred_2_function_admix(fit_bsug_admixed)

bsug_pred_2_function_neosho <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
bsug_pred_2_function_neosho(fit_bsug_neosho)

bsug_pred_2_function_northern<- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:4
bsug_pred_2_function_admix(fit_bsug_northern)


ages <- seq(-1,15,by=0.2)
bsug_admix_indiv_boot <- Boot(fit_bsug_admixed, f = bsug_pred_2_function_admix) #998 out of 999

ages <- seq(-1,15,by=0.2)
bsug_neosho_indiv_boot <- Boot(fit_bsug_neosho, f = bsug_pred_2_function_neosho) #997 out of 999

ages <- seq(-1,15,by=0.2)
bsug_northern_indiv_boot <- Boot(fit_bsug_northern, f = bsug_pred_2_function_northern) #998 out of 999

preds1_bsug_admix <- data.frame(ages,
                     predict(fit_bsug_admixed,data.frame(consensus_age=ages)),
                     confint(bsug_admix_indiv_boot))
names(preds1_bsug_admix) <- c("age","fit","LCI","UCI")
preds1_bsug_admix$hyb_status <- c(rep("Admixed",times=81))


preds1_bsug_neosho <- data.frame(ages,
                     predict(fit_bsug_neosho,data.frame(consensus_age=ages)),
                     confint(bsug_neosho_indiv_boot))
names(preds1_bsug_neosho) <- c("age","fit","LCI","UCI")
preds1_bsug_neosho$hyb_status <- c(rep("Neosho",times=81))

preds1_bsug_northern <- data.frame(ages,
                     predict(fit_bsug_northern,data.frame(consensus_age=ages)),
                     confint(bsug_northern_indiv_boot))
names(preds1_bsug_northern) <- c("age","fit","LCI","UCI")
preds1_bsug_northern$hyb_status <- c(rep("Northern",times=81))

bsug_preds1_all_smb <- rbind(preds1_bsug_admix,
                        preds1_bsug_neosho,
                        preds1_bsug_northern)


bsug_preds1_all_smb$river <- c(rep("Big Sugar Creek",times=243))

bsug_preds1_obs_admix <- filter(preds1_bsug_admix,age>=2,age<=7)
bsug_preds1_obs_admix$hyb_status <- c(rep("Admixed",times=26))

bsug_preds1_obs_neosho <- filter(preds1_bsug_neosho,age>=2,age<=7)
bsug_preds1_obs_neosho$hyb_status <- c(rep("Neosho",times=26))

bsug_preds1_obs_northern <- filter(preds1_bsug_northern,age>=2,age<=4)
bsug_preds1_obs_northern$hyb_status <- c(rep("Northern",times=11))

bsug_preds1_obs_all_smb <- rbind(bsug_preds1_obs_admix,
                        bsug_preds1_obs_neosho,
                        bsug_preds1_obs_northern)

bsug_preds1_all_smb_positive <- bsug_preds1_all_smb[-c(1:10),]
```


## Fit models to genetic groups WITHIN ELK RIVER
```{r}
#Write a funciton for optimizing the von Bert model (this is used below)
vb_function <- vbFuns(param = "Typical")

#Get starting values for von Bert optimization
f_starts_elk_admixed <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_elk_admixed)
f_starts_elk_neosho <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_elk_neosho)
f_starts_elk_northern <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_elk_northern)

#Fit von Bert function
fit_elk_admixed <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_elk_admixed, start = f_starts_elk_admixed)
fit_elk_neosho <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_elk_neosho, start = f_starts_elk_neosho)
fit_elk_northern <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_elk_northern, start = f_starts_elk_northern)

#Get coefficients from the model fit
elk_admix_coefficients <- coef(fit_elk_admixed)
    #Linf = 353.19
    #K = 0.57
    #t0 = 0.13

elk_neosho_coefficients <- coef(fit_elk_neosho)
    #Linf = 406.15
    #K = 0.39
    #t0 = -0.21

elk_northern_coefficients <- coef(fit_elk_northern)
    #Linf = 438.20
    #K = 0.33
    #t0 = -0.07

elk_admix_bootstrap <- Boot(fit_elk_admixed) #998 out of 999 attempted
elk_neosho_bootstrap <- Boot(fit_elk_neosho) #989 out of 999 attempted
elk_northern_bootstrap <- Boot(fit_elk_northern) #919 out of 999 attempted

elk_admix_confint <- confint(elk_admix_bootstrap)
elk_neosho_confint <- confint(elk_neosho_bootstrap)
elk_northern_confint <- confint(elk_northern_bootstrap)

elk_admix_pred <- predict(fit_elk_admixed,data.frame(consensus_age=2:8))
elk_neosho_pred <- predict(fit_elk_neosho,data.frame(consensus_age=2:7))
elk_northern_pred <- predict(fit_elk_northern,data.frame(consensus_age=2:7)) 

#write functions to bootstrap over individual ages
elk_pred_2_function_admix <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:8
elk_pred_2_function_admix(fit_elk_admixed)

elk_pred_2_function_neosho <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
elk_pred_2_function_neosho(fit_elk_neosho)

elk_pred_2_function_northern<- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
elk_pred_2_function_admix(fit_elk_northern)


ages <- seq(-1,15,by=0.2)
elk_admix_indiv_boot <- Boot(fit_elk_admixed, f = elk_pred_2_function_admix) #998 out of 999

ages <- seq(-1,15,by=0.2)
elk_neosho_indiv_boot <- Boot(fit_elk_neosho, f = elk_pred_2_function_neosho) #997 out of 999

ages <- seq(-1,15,by=0.2)
elk_northern_indiv_boot <- Boot(fit_elk_northern, f = elk_pred_2_function_northern) #998 out of 999

preds1_elk_admix <- data.frame(ages,
                     predict(fit_elk_admixed,data.frame(consensus_age=ages)),
                     confint(elk_admix_indiv_boot))
names(preds1_elk_admix) <- c("age","fit","LCI","UCI")
preds1_elk_admix$hyb_status <- c(rep("Admixed",times=81))


preds1_elk_neosho <- data.frame(ages,
                     predict(fit_elk_neosho,data.frame(consensus_age=ages)),
                     confint(elk_neosho_indiv_boot))
names(preds1_elk_neosho) <- c("age","fit","LCI","UCI")
preds1_elk_neosho$hyb_status <- c(rep("Neosho",times=81))

preds1_elk_northern <- data.frame(ages,
                     predict(fit_elk_northern,data.frame(consensus_age=ages)),
                     confint(elk_northern_indiv_boot))
names(preds1_elk_northern) <- c("age","fit","LCI","UCI")
preds1_elk_northern$hyb_status <- c(rep("Northern",times=81))

elk_preds1_all_smb <- rbind(preds1_elk_admix,
                        preds1_elk_neosho,
                        preds1_elk_northern)

elk_preds1_all_smb$river <- c(rep("Elk River",times=243))


elk_preds1_obs_admix <- filter(preds1_elk_admix,age>=2,age<=8)
elk_preds1_obs_admix$hyb_status <- c(rep("Admixed",times=31))

elk_preds1_obs_neosho <- filter(preds1_elk_neosho,age>=2,age<=7)
elk_preds1_obs_neosho$hyb_status <- c(rep("Neosho",times=26))

elk_preds1_obs_northern <- filter(preds1_elk_northern,age>=2,age<=7)
elk_preds1_obs_northern$hyb_status <- c(rep("Northern",times=26))

elk_preds1_obs_all_smb <- rbind(elk_preds1_obs_admix,
                        elk_preds1_obs_neosho,
                        elk_preds1_obs_northern)

elk_preds1_all_smb_positive <- elk_preds1_all_smb[-c(1:10),]
```

```{r}

preds1_all_smb_both_rivers <- rbind(bsug_preds1_all_smb, elk_preds1_all_smb)
levels(smbfit_age_data_clean_actual$river) <- c("Big Sugar Creek","Elk River")

vonbert_admix_status_both_rivers <- ggplot() + 
  geom_ribbon(data=preds1_all_smb_both_rivers, aes(x = age, ymin = LCI, ymax = UCI, fill = hyb_status, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual,aes(x = consensus_age,y = tl_alive, fill = hyb_status), show.legend = T, size=3, pch=21, position = position_jitter(width = 0.3)) + 
  geom_line(data=preds1_all_smb_both_rivers, aes(x=age, y=fit, linetype = hyb_status)) +
  theme_set(theme_cowplot(12)) +
  facet_wrap(~river, ncol = 2) +
  theme(strip.background = element_rect(fill = "white")) +
  theme(strip.text = element_text(size = 15)) +
  theme(panel.background = element_rect(color = "black", fill = "white", size = 1, linetype = "solid")) +
  theme(panel.margin = unit(1, "lines")) +
  scale_fill_manual(values=c("mediumpurple","deepskyblue","deeppink2")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,750),expand=c(0,0),breaks = seq(0,750,100)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Admixture Status", linetype = "Admixture Status") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.05,0.8)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 13)) +
  scale_alpha(guide = 'none')




#Plot von Bert growth for all admixture status groups (Pure Neosho, Pure Northern, and Admixed) WITHIN BIG SUGAR CREEK
vonbert_admix_status_bsug <- ggplot() + 
  geom_ribbon(data=bsug_preds1_all_smb, aes(x = age, ymin = LCI, ymax = UCI,fill = hyb_status, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual_bsug,aes(x = consensus_age,y = tl_alive, fill = hyb_status), show.legend = T, size=3, pch=21, position = position_jitter(width = 0.3)) + 
  geom_line(data=bsug_preds1_all_smb, aes(x=age, y=fit, linetype = hyb_status)) +
  theme_set(theme_cowplot(12)) +
  scale_fill_manual(values=c("mediumpurple","deepskyblue","deeppink2")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,750),expand=c(0,0),breaks = seq(0,750,100)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Admixture Status", linetype = "Admixture Status") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.05,0.8)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 13)) +
  scale_alpha(guide = 'none')


#Plot von Bert growth for all admixture status groups (Pure Neosho, Pure Northern, and Admixed) WITHIN BIG SUGAR CREEK
vonbert_admix_status_elk <- ggplot() + 
  geom_ribbon(data=elk_preds1_all_smb, aes(x = age, ymin = LCI, ymax = UCI,fill = hyb_status, alpha=0.01), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual_elk,aes(x = consensus_age,y = tl_alive, fill = hyb_status), show.legend = F, size=3, pch=21, position = position_jitter(width = 0.3)) + 
  geom_line(data=elk_preds1_all_smb, aes(x=age, y=fit, linetype = hyb_status), show.legend = F) +
  theme_set(theme_cowplot(12)) +
  scale_fill_manual(values=c("mediumpurple","deepskyblue","deeppink2")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,600),expand=c(0,0),breaks=seq(0,600,100)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Admixture Status", linetype = "Admixture Status") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.05,0.8)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 13)) +
  scale_alpha(guide = 'none') +
  theme(axis.title.y = element_blank())


##Plot both BIG SUGAR CREEK and ELK together
pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Fitness/visualization/growth_figures/von_bert_gen_by_river.pdf", width = 10, height = 5)

ggplot() + 
  geom_ribbon(data=preds1_all_smb_both_rivers, aes(x = age, ymin = LCI, ymax = UCI, fill = hyb_status, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual,aes(x = consensus_age,y = tl_alive, fill = hyb_status), show.legend = T, size=3, pch=21, position = position_jitter(width = 0.3)) + 
  geom_line(data=preds1_all_smb_both_rivers, aes(x=age, y=fit, linetype = hyb_status)) +
  theme_set(theme_cowplot(12)) +
  facet_wrap(~river, ncol = 2) +
  theme(strip.background = element_rect(fill = "white")) +
  theme(strip.text = element_text(size = 15)) +
  theme(panel.background = element_rect(color = "black", fill = "white", size = 1, linetype = "solid")) +
  theme(panel.margin = unit(1, "lines")) +
  scale_fill_manual(values=c("mediumpurple","deepskyblue","deeppink2")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,750),expand=c(0,0),breaks = seq(0,750,100)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Admixture Status", linetype = "Admixture Status") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.03,0.7)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 13)) +
  scale_alpha(guide = 'none')

dev.off()


```




  





## Here I will attempt to do two replicated growth curves, one for Elk River and one for Big Sugar Creek, running separate curves for each sex within each river.

## Prepare to fit Von Bertalanffy growth models to sexes
```{r}
##Split the dataset into three usable datasets for admixed individuals, pure neosho, and pure northern

#BIG SUGAR CREEK
smbfit_age_bsug_male <- smbfit_age_bsug %>%
  filter(sex =="Male")

smbfit_age_bsug_female <- smbfit_age_bsug %>%
  filter(sex =="Female")

#BIG SUGAR CREEK
smbfit_age_elk_male <- smbfit_age_elk %>%
  filter(sex =="Male")

smbfit_age_elk_female <- smbfit_age_elk %>%
  filter(sex =="Female")

```

## Fit models to sexes WITHIN BIG SUGAR CREEK 
```{r}

#Write a funciton for optimizing the von Bert model (this is used below)
vb_function <- vbFuns(param = "Typical")

#Get starting values for von Bert optimization
f_starts_bsug_male <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_bsug_male)
f_starts_bsug_female <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_bsug_female)

#Fit von Bert function
fit_bsug_male <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_bsug_male, start = f_starts_bsug_male)
fit_bsug_female <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_bsug_female, start = f_starts_bsug_female)


#Get coefficients from the model fit
bsug_male_coefficients <- coef(fit_bsug_male)
    #Linf = 448.35
    #K = 0.29
    #t0 = -0.225

bsug_female_coefficients <- coef(fit_bsug_female)
    #Linf = 512.55
    #K = 0.21
    #t0 = -0.53

bsug_male_bootstrap <- Boot(fit_bsug_male) #998 out of 999 attempted
bsug_female_bootstrap <- Boot(fit_bsug_female) #997 out of 999 attempted

bsug_male_confint <- confint(bsug_male_bootstrap)
bsug_female_confint <- confint(bsug_female_bootstrap)

bsug_male_pred <- predict(fit_bsug_male,data.frame(consensus_age=2:7))
bsug_female_pred <- predict(fit_bsug_female,data.frame(consensus_age=2:7))


#write functions to bootstrap over individual ages
pred_2_function_bsug_male <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
pred_2_function_bsug_male(fit_bsug_male)

pred_2_function_bsug_female <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
pred_2_function_bsug_female(fit_bsug_female)


ages <- seq(-1,15,by=0.2)
bsug_male_indiv_boot <- Boot(fit_bsug_male, f = pred_2_function_bsug_male) #996 out of 999

ages <- seq(-1,15,by=0.2)
bsug_female_indiv_boot <- Boot(fit_bsug_female, f = pred_2_function_bsug_female) #996 out of 999


preds1_bsug_male <- data.frame(ages,
                     predict(fit_bsug_male,data.frame(consensus_age=ages)),
                     confint(bsug_male_indiv_boot))
names(preds1_bsug_male) <- c("age","fit","LCI","UCI")
preds1_bsug_male$sex <- c(rep("Male",times=81))


preds1_bsug_female <- data.frame(ages,
                     predict(fit_bsug_female,data.frame(consensus_age=ages)),
                     confint(bsug_female_indiv_boot))
names(preds1_bsug_female) <- c("age","fit","LCI","UCI")
preds1_bsug_female$sex <- c(rep("Female",times=81))


preds1_all_bsug_sexes <- rbind(preds1_bsug_male,
                        preds1_bsug_female)

preds1_all_bsug_sexes$river <- c(rep("Big Sugar Creek",times=162))

preds1_obs_bsug_male <- filter(preds1_bsug_male,age>=2,age<=7)
preds1_obs_bsug_male$sex <- c(rep("Male",times=26))

preds1_obs_bsug_female <- filter(preds1_bsug_female,age>=2,age<=7)
preds1_obs_bsug_female$sex <- c(rep("Female",times=26))

preds1_obs_all_bsug_sexes <- rbind(preds1_obs_bsug_male,
                        preds1_obs_bsug_female)

```


## Fit models to sexes WITHIN ELK RIVER
```{r}

#Write a funciton for optimizing the von Bert model (this is used below)
vb_function <- vbFuns(param = "Typical")

#Get starting values for von Bert optimization
f_starts_elk_male <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_elk_male)
f_starts_elk_female <- vbStarts(tl_alive ~ consensus_age, data = smbfit_age_elk_female)

#Fit von Bert function
fit_elk_male <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_elk_male, start = f_starts_elk_male)
fit_elk_female <- nls(tl_alive ~ vb_function(consensus_age,Linf,K,t0), data = smbfit_age_elk_female, start = f_starts_elk_female)


#Get coefficients from the model fit
elk_male_coefficients <- coef(fit_elk_male)
    #Linf = 418.42
    #K = 0.43
    #t0 = 0.05

elk_female_coefficients <- coef(fit_elk_female)
    #Linf = 385.99
    #K = 0.40
    #t0 = -0.08

elk_male_bootstrap <- Boot(fit_elk_male) #998 out of 999 attempted
elk_female_bootstrap <- Boot(fit_elk_female) #997 out of 999 attempted

elk_male_confint <- confint(elk_male_bootstrap)
elk_female_confint <- confint(elk_female_bootstrap)

elk_male_pred <- predict(fit_elk_male,data.frame(consensus_age=2:7))
elk_female_pred <- predict(fit_elk_female,data.frame(consensus_age=2:8))


#write functions to bootstrap over individual ages
pred_2_function_elk_male <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:7
pred_2_function_elk_male(fit_elk_male)

pred_2_function_elk_female <- function(x) predict(x,data.frame(consensus_age=ages))
ages=2:8
pred_2_function_elk_female(fit_elk_female)


ages <- seq(-1,15,by=0.2)
elk_male_indiv_boot <- Boot(fit_elk_male, f = pred_2_function_elk_male) #996 out of 999

ages <- seq(-1,15,by=0.2)
elk_female_indiv_boot <- Boot(fit_elk_female, f = pred_2_function_elk_female) #996 out of 999


preds1_elk_male <- data.frame(ages,
                     predict(fit_elk_male,data.frame(consensus_age=ages)),
                     confint(elk_male_indiv_boot))
names(preds1_elk_male) <- c("age","fit","LCI","UCI")
preds1_elk_male$sex <- c(rep("Male",times=81))


preds1_elk_female <- data.frame(ages,
                     predict(fit_elk_female,data.frame(consensus_age=ages)),
                     confint(elk_female_indiv_boot))
names(preds1_elk_female) <- c("age","fit","LCI","UCI")
preds1_elk_female$sex <- c(rep("Female",times=81))


preds1_all_elk_sexes <- rbind(preds1_elk_male,
                        preds1_elk_female)

preds1_all_elk_sexes$river <- c(rep("Elk River",times=162))

preds1_obs_elk_male <- filter(preds1_elk_male,age>=2,age<=7)
preds1_obs_elk_male$sex <- c(rep("Male",times=26))

preds1_obs_elk_female <- filter(preds1_elk_female,age>=2,age<=8)
preds1_obs_elk_female$sex <- c(rep("Female",times=31))

preds1_obs_all_elk_sexes <- rbind(preds1_obs_elk_male,
                        preds1_obs_elk_female)

```

```{r}

preds1_all_smb_both_sexes <- rbind(preds1_all_bsug_sexes, preds1_all_elk_sexes)
levels(smbfit_age_data_clean_actual$river) <- c("Big Sugar Creek","Elk River")

pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Fitness/visualization/growth_figures/von_bert_sex_by_river.pdf", width = 10, height = 5)

ggplot() + 
  geom_ribbon(data=preds1_all_smb_both_sexes, aes(x = age, ymin = LCI, ymax = UCI, fill = sex, alpha=0.01,), show.legend = F) +
  geom_point(data=smbfit_age_data_clean_actual, aes(x = consensus_age,y = tl_alive, fill = sex), show.legend = T, size=3, pch=21, position = position_jitter(width = 0.3)) + 
  geom_line(data=preds1_all_smb_both_sexes, aes(x=age, y=fit, linetype = sex)) +
  theme_set(theme_cowplot(12)) +
  facet_wrap(~river, ncol = 2) +
  theme(strip.background = element_rect(fill = "white")) +
  theme(strip.text = element_text(size = 15)) +
  theme(panel.background = element_rect(color = "black", fill = "white", size = 1, linetype = "solid")) +
  theme(panel.margin = unit(1, "lines")) +
  scale_fill_manual(values=c("mediumspringgreen","coral1")) +
  scale_y_continuous(name="Total Length (mm)",limits=c(0,750),expand=c(0,0),breaks = seq(0,750,100)) +
  scale_x_continuous(name="Age (years)",expand=c(0,0),limits=c(0,15),breaks=seq(0,15,1)) +
  labs(fill = "Sex", linetype = "Sex") +
  theme(axis.title = element_text(size = 15)) + 
  theme(legend.position = c(0.03,0.7)) +
  theme(legend.title = element_text(face="bold",size = 15)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 13)) +
  scale_alpha(guide = 'none')

dev.off()


```