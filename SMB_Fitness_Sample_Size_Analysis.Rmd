---
title: "SMB_Fitness_Sample_Analysis"
author: "Joe Gunn"
date: "12/15/2020"
output: html_document
---
# Libraries needed for analysis
```{r setup, include=FALSE}
library(readxl)
library(tidyverse)
library(cowplot)
```

# Read in raw working data
```{r}
smbfit_data <- read_excel("../../raw_data/master_data/smbfit_master_data_working.xlsx")

#Clean up and prepare dataset for plotting size distributions
smbfit_data_size_dist <- smbfit_data[,c(1,5,11,12,24)]

smbfit_data_size_dist <- smbfit_data_size_dist %>%
  mutate(sample_id = factor(sample_id),
         river = factor(river),
         sex = factor(sex),
         tl_alive = as.numeric(tl_alive), 
         size_category = factor(size_category))

#Drop the one NA in the dataset where I don't have total length for the fish
smbfit_data_size_dist <- smbfit_data_size_dist %>%
  drop_na()
```


```{r}

#Get total number of samples per size category
smbfit_num_per_size_total <- smbfit_data_size_dist %>%
  group_by(size_category) %>%
  count() %>%
  as.data.frame()

#Get total number of samples per size category, per river
smbfit_num_per_size_by_river <- smbfit_data_size_dist %>%
  group_by(size_category, river) %>%
  count() %>%
  as.data.frame()

#Get total number of samples per size category, per sex
smbfit_num_per_size_by_sex <- smbfit_data_size_dist %>%
  group_by(size_category, sex) %>%
  count() %>%
  as.data.frame()


#Prepare datasets by creating columns with readable names
smbfit_num_per_size_by_river$river_name <- c("Big Sugar Creek", "Elk River","Big Sugar Creek", "Elk River","Big Sugar Creek", "Elk River","Big Sugar Creek", "Elk River","Big Sugar Creek", "Elk River","Big Sugar Creek", "Elk River","Big Sugar Creek", "Elk River","Big Sugar Creek", "Elk River")

smbfit_num_per_size_by_sex$sex_name <- c("Female", "Male","Female", "Male","Female", "Male","Female", "Male","Female", "Male","Female", "Male","Female", "Male","Female", "Male")

smbfit_num_per_size_by_sex$size_bins <- c("200-225","200-225","225-250","225-250","250-275","250-275","275-300","275-300","300-325","300-325","325-350","325-350","350-375","350-375","375-400+","375-400+")
                               
                                                             
                                                    


#Plot total number of samples per size category
smb_fit_size_dist_total <- ggplot(smbfit_num_per_size_total, aes(x = size_category, y = n)) + 
  geom_bar(stat = "identity", color = "black", fill = "grey") + 
  theme_set(theme_cowplot(12)) +
  labs(x = "Size Category", y = "Number of Individuals") + 
  theme(axis.text.y = element_text(size = 15)) +
  theme(axis.title.y = element_text(size = 15)) +
  theme(axis.text.x = element_blank()) +
  theme(axis.title.x = element_blank())

#Plot total number of samples per size category, per river
smb_fit_size_dist_river <- ggplot(smbfit_num_per_size_by_river, aes(x = size_category, y = n, fill = river_name)) + 
  geom_bar(stat = "identity", position = position_dodge(), color = "black") + 
  theme_set(theme_cowplot(12)) +
  labs(x = "Size Bins (mm)", y = "Number of Individuals", fill = "River") + 
  scale_fill_manual(values = c("grey","black")) +
  theme(legend.title = element_text(size = 15, face = "bold")) +
  theme(legend.position = c(0.65,0.8)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text.y = element_text(size = 15)) +
  theme(axis.title.y = element_text(size = 15)) +
  theme(axis.text.x = element_blank()) +
  theme(axis.title.x = element_blank())

#Plot total number of samples per size category, per sex
smb_fit_size_dist_sex <- ggplot(smbfit_num_per_size_by_sex, aes(x = size_bins, y = n, fill = sex_name)) + 
  geom_bar(stat = "identity", position = position_dodge(), color = "black") + 
  theme_set(theme_cowplot(12)) +
  labs(x = "Size Bins (mm)", y = "Number of Individuals", fill = "Sex") + 
  scale_fill_manual(values = c("grey","black")) +
  theme(legend.title = element_text(size = 15, face = "bold")) +
  theme(legend.position = c(0.65,0.8)) +
  theme(legend.text = element_text(size = 15)) +
  theme(axis.text = element_text(size = 15)) +
  theme(axis.text.x = element_text(angle = 30, hjust = 0.9)) +
  theme(axis.title = element_text(size = 15))

#Plot all size distributions (total, by river, and by sex)
pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Fitness/visualization/sample_visualization/total_sample_distribution.pdf", width = 6, height = 12)

plot_grid(smb_fit_size_dist_total, 
          smb_fit_size_dist_river, 
          smb_fit_size_dist_sex,
          ncol = 1, 
          labels = c("a","b","c"), 
          label_size = 20)

dev.off()
```
